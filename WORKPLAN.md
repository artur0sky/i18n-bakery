# ğŸ¥¯ i18n-bakery â€” Plan de Trabajo

Este documento describe el plan de implementaciÃ³n completo de **i18n-bakery**, actualizado segÃºn los cambios implementados en cada versiÃ³n.

---

## Estado de ImplementaciÃ³n

### âœ… FASE 1 â€” Runtime bÃ¡sico (Core v1) â€” **COMPLETADA** (v0.1.0)
- âœ… I18nService con Clean Architecture
- âœ… MemoryStore adapter
- âœ… MustacheFormatter para interpolaciÃ³n `{{variable}}`
- âœ… API pÃºblica: `initI18n()`, `t()`, `setLocale()`, `addTranslations()`
- âœ… Testing con vitest (100% coverage)

### âœ… FASE 2 â€” Auto-guardado (Self-Rising) â€” **COMPLETADA** (v0.2.0)
- âœ… TranslationSaver port
- âœ… JSONFileSaver adapter (Node.js)
- âœ… ConsoleSaver adapter
- âœ… DetecciÃ³n automÃ¡tica de claves faltantes
- âœ… Testing de auto-save

### âœ… FASE 3 â€” CLI (The Mixer) â€” **COMPLETADA** (v0.3.0)
- âœ… Comando `batter`: extracciÃ³n de claves desde cÃ³digo
- âœ… Comando `bake`: compilaciÃ³n de archivos JSON
- âœ… Parsing AST con Babel
- âœ… Inferencia de namespaces
- âœ… Testing de integraciÃ³n

### âœ… FASE 4 â€” React Bindings (The Glaze) â€” **COMPLETADA** (v0.4.0)
- âœ… I18nProvider component
- âœ… useTranslation() hook (antes useT)
- âœ… useI18n() hook
- âœ… Actualizaciones reactivas
- âœ… Soporte de namespace prefixes
- âœ… Testing con @testing-library/react-hooks

### âœ… FASE 5 â€” Compatibilidad i18next â€” **COMPLETADA** (v0.5.0)
- âœ… Soporte de notaciÃ³n `ns:key`
- âœ… InterpolaciÃ³n anidada profunda `{{user.profile.name}}`
- âœ… Testing de compatibilidad (98% compatible)

### âœ… FASE 6 â€” Monorepo y DocumentaciÃ³n â€” **COMPLETADA** (v0.6.0)
- âœ… Estructura pnpm workspace
- âœ… Ejemplo react-basic
- âœ… DocumentaciÃ³n completa en docs/
- âœ… READMEs con tema "Bakery"
- âœ… ConfiguraciÃ³n NPM pÃºblica
- âœ… Compatibilidad CJS/ESM

### âœ… FASE 7 â€” Advanced Key Engine (The Filing System) â€” **COMPLETADA** (v0.7.0)
- âœ… Parsing jerÃ¡rquico con `:` y `.`
- âœ… KeyParser port + DefaultKeyParser adapter
- âœ… PathResolver port + FileSystemPathResolver adapter
- âœ… NormalizaciÃ³n automÃ¡tica de claves
- âœ… Testing completo (29 tests, 100% coverage)
- âœ… Ejemplo: `orders:meal.orderComponent.title` â†’ `/orders/meal/orderComponent.json` con propiedad `title`

---

## Fases Pendientes

# FASE 8 â€” DetecciÃ³n avanzada de variables y auto-generaciÃ³n

## 8.1 DetecciÃ³n de variables en runtime

Cuando el usuario llama:

```javascript
t("orders:meal.title", { meal: "Enchiladas", price: 120 })
```

Las variables detectadas deben almacenarse en la entrada si aÃºn no existe.

**ImplementaciÃ³n basada en v0.7.0:**
- La clave `orders:meal.title` se parsea como:
  - Directorio: `/orders/meal/`
  - Archivo: `title.json` (o parte de un archivo mayor segÃºn configuraciÃ³n)
  - Propiedad: `title`

## 8.2 DetecciÃ³n de ausencia de texto default

Comportamiento requerido:

Si el usuario usa:

```javascript
t("orders:meal.title", { meal: "â€¦" })
```

y no existe traducciÃ³n, crear la entrada automÃ¡ticamente:

```json
{
  "title": {
    "_autoGenerated": true,
    "variables": ["meal"],
    "value": ""
  }
}
```

Si existe una traducciÃ³n, usarla sin crear valores nuevos.

## 8.3 Sistema de firmas de variables (variable signature)

**ACTUALIZADO segÃºn v0.7.0 â€” Advanced Key Engine**

El parsing jerÃ¡rquico ya estÃ¡ implementado:
- `:` (colon) define niveles de directorio
- `.` (dot) separa componentes y propiedades
- Ejemplo: `orders:meal.title` â†’ `/orders/meal.json` con propiedad `title`

Para diferenciar variantes de la misma key cuando las variables difieren:

**Ejemplo:**
```javascript
t("orders:meal.title", { meal: "Pizza" })
```
â†’ Firma: `["meal"]`

```javascript
t("orders:meal.title", { meal: "Pizza", price: 120 })
```
â†’ Firma: `["meal","price"]`

**ResoluciÃ³n:** Las variantes se almacenan internamente en el mismo archivo determinado por la estructura jerÃ¡rquica:

**Archivo:** `/orders/meal.json`
```json
{
  "title": {
    "variants": {
       "meal": {
         "variables": ["meal"],
         "value": "{{meal}}"
       },
       "meal_price": {
         "variables": ["meal", "price"],
         "value": "{{meal}} - ${{price}}"
       }
    }
  }
}
```

**IMPORTANTE:** El nombre del archivo **NO** cambia segÃºn las variables, solo segÃºn la estructura jerÃ¡rquica de la clave parseada por `DefaultKeyParser`.

---

# FASE 9 â€” Auto-creaciÃ³n y mantenimiento de archivos (FileEngine v3)

## 9.1 Crear entrada si no existe

**Actualizado para usar v0.7.0 â€” PathResolver**

-   Usar `KeyParser` para obtener `ParsedKey`
-   Usar `PathResolver` para obtener la ruta del archivo
-   Crear estructura de directorios automÃ¡ticamente
-   Crear variantes segÃºn firma de variables
-   Insertar placeholders:

```json
"value": "{{meal}} {{price}}"
```

## 9.2 Actualizar entrada existente

-   Si la key existe pero falta una variable:
    -   Agregar variable a la firma correspondiente
    -   NO reemplazar textos existentes a menos que el usuario lo indique explÃ­citamente

## 9.3 Formateo automÃ¡tico de JSON

-   Aplicar prettier-like formatting
-   Opcional: permitir YAML

## 9.4 Modo "append-only"

-   Configurable para evitar sobrescribir valores establecidos manualmente

---

# FASE 10 â€” Resolver final + CLI avanzado (Full Runtime v2)

## 10.1 Resolver final de traducciones

**Actualizado para usar v0.7.0 â€” Advanced Key Engine**

Cuando el usuario llama:

```javascript
t("orders:meal.title", { meal: "Tacos", price: 80 })
```

El sistema debe:

1.  Parsear key usando `KeyParser` â†’ `ParsedKey`
2.  Resolver archivo usando `PathResolver` â†’ ruta fÃ­sica
3.  Cargar archivo JSON
4.  Seleccionar variante segÃºn firma de variables
5.  Rellenar plantilla con `MustacheFormatter`
6.  Retornar resultado

## 10.2 CLI: i18n-bakery scan

Agrega detecciÃ³n automÃ¡tica en cÃ³digo:

-   Buscar llamadas `t("key", {...})`
-   Detectar:
    -   clave (con soporte de `:` y `.`)
    -   variables
    -   default (si lo hay)
-   Usar `KeyParser` y `PathResolver` para determinar ubicaciÃ³n
-   Crear o actualizar archivos de traducciÃ³n

## 10.3 CLI: i18n-bakery apresto

**Funciones:**

-   Detectar claves huÃ©rfanas
-   Detectar variables inconsistentes
-   Detectar mÃºltiples firmas conflictivas
-   Recomendar cleanup de archivos
-   Validar estructura jerÃ¡rquica de directorios

## 10.4 CLI: i18n-bakery migrate i18next

Permitir migrar proyectos i18next automÃ¡ticamente.

## 10.5 IntegraciÃ³n monorepo con pnpm

**âœ… YA IMPLEMENTADO en v0.6.0**

Estructura actual:

```
/packages
  /core
  /react
  /cli
/examples
  /react-basic
```

Cada paquete con:

-   TS build
-   pnpm workspaces
-   `exports` en `package.json`

## 10.6 Tipos avanzados

Para TypeScript generar:

```typescript
type TranslationKeys = "orders:meal.title" | "auth:login" | ...
```

Via anÃ¡lisis estÃ¡tico de la carpeta de traducciones.

---

# FASE 11 â€” Plugins y extensiones (opcional pero recomendado)

## 11.1 Plugins de almacenamiento

Soportar:

-   FS (default) â€” **âœ… Implementado en v0.7.0 con FileSystemPathResolver**
-   S3
-   Supabase
-   Github repos autogenerados

## 11.2 Formato mÃºltiple

Permitir elegir:

-   JSON (default)
-   YAML
-   TOML

## 11.3 Editor web opcional

UI estilo i18next Editor.

---

# FASE 12 â€” DocumentaciÃ³n y ejemplos

## 12.1 Comparaciones oficiales vs i18next

**Parcialmente implementado en v0.5.0 y v0.6.0**

Demostrar:

-   âœ… menos boilerplate
-   âœ… detecciÃ³n automÃ¡tica
-   âœ… cero dependencias crÃ­ticas
-   ğŸ”„ versiones multivariable (pendiente Fase 8.3)

## 12.2 Ejemplos completos

-   âœ… React (react-basic)
-   Next.js
-   Vite
-   Node backend
-   âœ… CLI usage (documentado)
-   âœ… Monorepo pnpm (implementado)

---

## Notas de Arquitectura (v0.7.0)

### Clean Architecture

El proyecto sigue estrictamente Clean Architecture:

**Domain (Interfaces/Ports):**
- `TranslationLoader`
- `TranslationSaver`
- `VariableFormatter`
- `KeyParser` â† **Nuevo en v0.7.0**
- `PathResolver` â† **Nuevo en v0.7.0**

**Adapters (Implementaciones):**
- `MemoryStore`
- `JSONFileSaver`
- `ConsoleSaver`
- `MustacheFormatter`
- `DefaultKeyParser` â† **Nuevo en v0.7.0**
- `FileSystemPathResolver` â† **Nuevo en v0.7.0**

**Use Cases:**
- `I18nService` (orquesta todos los ports)

### Estructura de Claves (v0.7.0)

**Formato:** `[directory:]...[directory:][file.]property`

**Ejemplos:**
- `orders:meal.title` â†’ `/orders/meal.json` â†’ propiedad `title`
- `auth:login.button` â†’ `/auth/login.json` â†’ propiedad `button`
- `common.greeting` â†’ `/common.json` â†’ propiedad `greeting`

**NormalizaciÃ³n automÃ¡tica:**
- Elimina separadores duplicados
- Limpia espacios en blanco
- Valida caracteres permitidos

---

*Ãšltima actualizaciÃ³n: 2025-12-06 (v0.7.0 â€” The Structured Pantry)*